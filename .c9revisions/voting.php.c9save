{"ts":1347546774596,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"#!/usr/bin/php\n\t<?php\n\t\t//Vote Control\n\t\t$playersVotedYes = array();\n\t\t$playersVotedNo = array();\n        $playersAlive = array();\n\t\t$numPlayersVoteYes;\n\t\t$numPlayersVoteNo;\n\t\t$voteInSession = false;\n\t\t$voteSessionTime = 20; //In Seconds\n\t\t$command;\n        $currGameMode = \"pandamonium\"; //Put the default cfg here.\n\t\t//Time Tracker\n\t\t$gameTimeCurr = 0;\n\t\t$gameTimeVoteEnd = -1;\n\t\t//File Includes\n        $pandamonium = \"sinclude settings_custom.cfg \\n\"; //Default CFG\n\t\t$teamsumo = \"sinclude teamsumo.cfg \\n\";\n\t\t$hr = \"sinclude hr.cfg \\n\";\n\t\t$df = \"sinclude df.cfg \\n\";\n\t\t//Files Array\n\t\t$filesToInclude = array($teamsumo, $pandamonium, $hr, $df);\n\t\t$filesToIncludeStrings = array(\"teamsumo\", \"pandamonium\", \"hr\", \"df\");\n\t\t\n\t\t//Function To Start The Voting Session And Determines The Length Of The Session\n\t\t\twhile(1)\n\t\t\t\t{\n\t\t\t\t\t$input = rtrim(fgets(STDIN, 1024)); \n\t\t\t\t\t$param = explode(\" \", $input);\n\t\t\t\t\t\n\t\t\t\t\t//Keep Track Of Time\t\n\t\t\t\t\tif (preg_match(\"/^GAME_TIME/\", $input))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$gameTimeCurr = $param[1];\n\t\t\t\t\t\t}\n\t\t\t\t\t//Track Players Alive\n                    if(preg_match(\"/^CYCLE_CREATED/\", $input))\n                        {\n                        \t$name = $param[1];\n                        \t$playersAlive[] = $name;\n                        }\n\t\t\t\t\t//Ends The Voting Sessions And Determines Outcome\n\t\t\t\t\tif ($gameTimeVoteEnd <= $gameTimeCurr && $voteInSession == true)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$voteInSession = false;\n\t\t\t\t\t\t\t$numPlayersVoteYes = count($playersVotedYes);\n\t\t\t\t\t\t\t$numPlayersVoteNo = count($playersVotedNo);\n\t\t\t\t\t\t\t//Do Or Not Do?\n\t\t\t\t\t\t\tif ($numPlayersVoteYes > $numPlayersVoteNo) //The Vote Has Been Accepted\n\t\t\t\t\t\t\t\t{\n                                    $currGameMode = $voteType;\n\t\t\t\t\t\t\t\t\tprint(\"console_message Vote Accepted! Config will be included immediately! \\n\");\n                                    print($command);\n                                    print(\"collapse_zone\\n\");\n                                    print(\"START_NEW_MATCH\\n\");\n                                    foreach($playersAlive as $value)\n                                        {\n                                                print(\"kill {$value}\\n\");\n                                        }  \n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telseif ($numPlayersVoteYes == $numPlayersVoteNo) //The Vote Tied\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tprint(\"console_message The vote has tied! No action will be taken.\\n\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse //The Vote Was Denied\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tprint(\"console_message The vote was denied! No action will be taken.\\n\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t$gameTimeVoteEnd = -1;\n\t\t\t\t\t\t\tunset($playersVotedYes);\n\t\t\t\t\t\t\tunset($playersVotedNo);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t//Include It When The Round Ends\n\t\t\t\t\tif (preg_match(\"/^NEW_ROUND/\", $input) && $voteInSession == true)\n\t\t\t\t\t\t{\n                            \n\t\t\t\t\t\t\t$gameTimeVoteEnd = $gameTimeVoteEnd - $gameTimeCurr;\n                            $gameTimeCurr = -2;\n                            print(\"console_message A vote is still in session for {$voteType}. Please type /yes or /no to vote.\\n\");\n\t\t\t\t\t\t}\n                    if (preg_match(\"/^NEW_ROUND/\", $input) && $voteInSession == false)\n\t\t\t\t\t\t{\n                            print(\"console_message The current game mode is {$currGameMode}. Type /chmode modehere to change that! Type /list for available modes.\\n\");\n\t\t\t\t\t\t}\n\t\t\t\t\t//Voting Control\n\t\t\t\t\tif (preg_match(\"/^INVALID_COMMAND/\", $input))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif ($param[1] == \"/chmode\" && $voteInSession == false)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$voteOwner = $param[2];\n\t\t\t\t\t\t\t\t\t$voteType = $param[5];\n\t\t\t\t\t\t\t\t\tif (in_array($param[5], $filesToIncludeStrings) && $voteType !== $currGameMode)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t$voteInSession = true;\n\t\t\t\t\t\t\t\t\t\t\tif ($voteType == \"teamsumo\") {$command = $teamsumo;}\n\t\t\t\t\t\t\t\t\t\t\telseif ($voteType == \"pandamonium\") {$command = $pandamonium;}\n\t\t\t\t\t\t\t\t\t\t\telseif ($voteType == \"hr\") {$command = $hr;}\n\t\t\t\t\t\t\t\t\t\t\telseif ($voteType == \"df\") {$command = $df;}\n                                            $playersVotedYes[] = $voteOwner; \n\t\t\t\t\t\t\t\t\t\t\t$gameTimeVoteEnd = $gameTimeCurr + $voteSessionTime;\n\t\t\t\t\t\t\t\t\t\t\tprint(\"console_message A vote has been cast for {$voteType}. Please vote /yes or /no in your chat! \\n\");\n\t\t\t\t\t\t\t\t\t\t}\n                                    elseif($voteType == $currGameMode)\n                                        {\n                                            print(\"player_message {$param[2]} \\\"That is already the current game mode!\\\"\\n\");\n                                        }\n\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tprint(\"player_message {$param[2]} \\\"That is not a valid game mode. Type /list for available modes!\\\"\\n\");\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telseif ($param[1] == \"/chmode\" && $voteInSession == true)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tprint(\"console_message A vote is already in session. Type /yes or /no to vote on it \\n\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telseif ($param[1] == \"/yes\" && $voteInSession == true)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif (!in_array($param[2], $playersVotedYes) && \n\t\t\t\t\t\t\t\t\t\t!in_array($param[2], $playersVotedNo))\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t$playersVotedYes[] = $param[2]; \n\t\t\t\t\t\t\t\t\t\t\t\tprint(\"player_message {$param[2]} \\\"Your vote has been cast!\\\"\\n\");\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tprint(\"player_message {$param[2]} \\\"You've already cast your vote\\\"\\n\");\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telseif ($param[1] == \"/no\" && $voteInSession == true)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif (!in_array($param[2], $playersVotedYes) && \n\t\t\t\t\t\t\t\t\t\t!in_array($param[2], $playersVotedNo))\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t$playersVotedNo[] = $param[2]; \n\t\t\t\t\t\t\t\t\t\t\t\tprint(\"player_message {$param[2]} \\\"Your vote has been cast!\\\"\\n\");\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tprint(\"player_message {$param[2]} \\\"You've already voted!\\\"\\n\");\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t//No Vote In Progress\n\t\t\t\t\t\t\telseif ($param[1] == \"/yes\" && $voteInSession == false)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tprint(\"player_message {$param[2]} \\\"There is no vote in progress. Type /chmode modehere to start a vote. Type /list for available modes!\\\"\\n\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telseif ($param[1] == \"/no\" && $voteInSession == false)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tprint(\"player_message {$param[2]} \\\"There is no vote in progress. Type /chmode modehere to start a vote. Type /list for available modes!\\\"\\n\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t//List The Modes\n\t\t\t\t\t\t\telseif ($param[1] == \"/list\")\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tforeach ($filesToIncludeStrings as $value)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tprint(\"player_message {$param[2]} \\\"0xff0010{$value}\\\"\\n\");\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n                            //DEBUG\n                            elseif($param[4] <= 1 && $param[1] == \"/gtc\")\n    \t\t\t\t\t        {\n\t\t\t\t\t\t\t        print(\"console_message {$gameTimeCurr}\\n\");\n\t\t\t\t\t\t        }\n                            elseif($param[4] <= 1 && $param[1] == \"/gtvt\")\n        \t\t\t\t        {\n\t\t\t\t\t\t\t        print(\"console_message {$gameTimeVoteEnd}\\n\");\n\t\t\t\t\t\t        }\n                            //END DEBUG\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tprint(\"player_message {$param[2]} \\\"Command does not exist!\\\"\\n\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t}\n\t?>\t\t\t"]],"start1":0,"start2":0,"length1":0,"length2":7003}]],"length":7003}
